env:
sudo: required
language: generic
dist: xenial
os:
  - linux
  - osx
addons:
  apt:
    packages: libc6-i386 sox python3-numpy valgrind fonts-freefont-otf libspeexdsp-dev
      libsamplerate0-dev portaudio19-dev libasound2-dev libao-dev libgsm1-dev libsndfile-dev
      mingw-w64
install:
  - export HABLIBDIR=${PWD}
  - export MAKEFLAGS=-j2
script:
  - cd ${HABLIBDIR} && mkdir -p build_linux && cd build_linux
  - cmake $HABLIBDIR && make -j4
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install sox; fi
  - ctest --output-on-failure
  - cd ${HABLIBDIR} && mkdir -p build_windows/src && cd build_windows
  - if [ "$TRAVIS_OS_NAME" != "osx" ]; then cmake $HABLIBDIR -DCMAKE_TOOLCHAIN_FILE=$HABLIBDIR/mingw-w64-x86_64.cmake && make -j4 ; fi

before_deploy:
  - cd ${HABLIBDIR}
deploy:
  provider: releases
  api_key:
    secure: #Use travis setup releases to configure this
  file: 
    - build_linux/src/libhorus.so # we might want to cross compile an arm version as well :)
    - build_linux/src/libhorus.dylib
    - build_windows/src/libhorus.dll
  on:
    repo: projecthorus/horusdemodlib
  skip_cleanup: 'true'
